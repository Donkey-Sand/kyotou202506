ä¸‹é¢æ˜¯ä¸€ä¸ª ä½¿ç”¨ Python + boto3ï¼ˆAWS SDK for Pythonï¼‰æ³¨å†Œ Cognito ç”¨æˆ·çš„è„šæœ¬ã€‚æ³¨å†Œçš„æ–°ç”¨æˆ·å°†èƒ½é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½• Web åº”ç”¨ç¨‹åºï¼ˆä½¿ç”¨ Cognito User Pool æä¾›çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼‰ã€‚

â¸»

âœ… å‰ææ¡ä»¶
	1.	ä½ å·²åˆ›å»º Cognito User Poolï¼Œä¸”è®¾ç½®å¥½ App clientï¼ˆä¸å¯ç”¨ SRP çš„æƒ…å†µä¸‹è®°å¾—å…³æ‰ Generate client secretï¼‰ã€‚
	2.	å®‰è£… boto3ï¼š

pip install boto3

	3.	ç¡®ä¿ä½ çš„ AWS CLI å·²ç»é…ç½®å¥½ aws configureï¼Œæˆ–è€…ä½¿ç”¨ boto3.Session æŒ‡å®šå‡­æ®ã€‚

â¸»

ğŸ§¾ è„šæœ¬ï¼ˆregister_user.pyï¼‰

import boto3
from botocore.exceptions import ClientError

# æ›¿æ¢ä¸ºä½ çš„ Cognito è®¾ç½®
USER_POOL_ID = 'ap-northeast-1_xxxxxxxx'  # Cognito User Pool ID
CLIENT_ID = 'xxxxxxxxxxxxxxxxxxxxxxxxxx'  # App client IDï¼Œæ³¨æ„ä¸è¦å¼€å¯ client secret
REGION = 'ap-northeast-1'

# è¦æ³¨å†Œçš„æ–°ç”¨æˆ·ä¿¡æ¯
username = 'exampleuser'
password = 'ExamplePassword123!'  # å¿…é¡»ç¬¦åˆ Cognito çš„å¯†ç ç­–ç•¥
email = 'user@example.com'

# åˆå§‹åŒ– Cognito IDP å®¢æˆ·ç«¯
client = boto3.client('cognito-idp', region_name=REGION)

def register_user():
    try:
        response = client.sign_up(
            ClientId=CLIENT_ID,
            Username=username,
            Password=password,
            UserAttributes=[
                {
                    'Name': 'email',
                    'Value': email
                }
            ]
        )
        print("âœ… æ³¨å†ŒæˆåŠŸï¼Œè¯·ç¡®è®¤é‚®ç®±æˆ–é€šè¿‡ç®¡ç†å‘˜ç¡®è®¤ç”¨æˆ·")
        print(response)
    except ClientError as e:
        print("âŒ æ³¨å†Œå¤±è´¥:", e.response['Error']['Message'])

def admin_confirm_user():
    try:
        response = client.admin_confirm_sign_up(
            UserPoolId=USER_POOL_ID,
            Username=username
        )
        print("âœ… ç®¡ç†å‘˜å·²ç¡®è®¤è¯¥ç”¨æˆ·ï¼ˆæ— éœ€é‚®ç®±éªŒè¯ï¼‰")
    except ClientError as e:
        print("âŒ ç®¡ç†å‘˜ç¡®è®¤å¤±è´¥:", e.response['Error']['Message'])

if __name__ == '__main__':
    register_user()
    # å¦‚æœä½ ä¸æƒ³ä½¿ç”¨é‚®ä»¶ç¡®è®¤ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä¸‹é¢è¿™è¡Œ
    # admin_confirm_user()


â¸»

ğŸ“Œ è¯´æ˜
	â€¢	è„šæœ¬å…ˆæ³¨å†Œä¸€ä¸ª Cognito ç”¨æˆ·ã€‚
	â€¢	é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·éœ€è¦ é‚®ç®±éªŒè¯ç ç¡®è®¤ æ‰èƒ½ç™»å½•ã€‚å¦‚æœä½ æƒ³ç»•è¿‡é‚®ç®±ç¡®è®¤ï¼Œåœ¨æ§åˆ¶å°è®¾ç½®ä¸­å…è®¸ç®¡ç†å‘˜ç¡®è®¤ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨ admin_confirm_sign_up()ã€‚
	â€¢	å¯†ç å¿…é¡»ç¬¦åˆä½  User Pool ä¸­è®¾å®šçš„å¯†ç ç­–ç•¥ï¼ˆå¦‚æœ€å°é•¿åº¦ã€åŒ…å«å¤§å†™ã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼‰ã€‚
	â€¢	è‹¥è¦ç«‹å³ç™»å½•ç”¨æˆ·ï¼Œå¯é…åˆ initiate_auth() æ–¹æ³•å®ç°ã€‚

â¸»

å¦‚æœä½ è¿˜éœ€è¦ç™»å½•çš„è„šæœ¬ã€ç™»å½•éªŒè¯æµç¨‹æˆ–æ•´åˆ React å‰ç«¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥ä¸€å¹¶å†™å‡ºæ¥ã€‚éœ€è¦ç»§ç»­å—ï¼Ÿ



å¥½çš„ï¼æˆ‘å°†ä¸ºä½ æä¾›ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ï¼šReact å‰ç«¯ + Cognito ç”¨æˆ·æ³¨å†Œä¸ç™»å½•æ•´åˆï¼ˆä¸ä½¿ç”¨ AWS Amplifyï¼‰ï¼Œä½¿ç”¨ amazon-cognito-identity-js åº“æ‰‹åŠ¨æ“ä½œ Cognitoã€‚

â¸»

ğŸ§° æ‰€éœ€ä¾èµ–

npm install amazon-cognito-identity-js


â¸»

ğŸ—‚ï¸ é¡¹ç›®ç»“æ„ç¤ºä¾‹

my-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ cognitoConfig.ts
â”‚   â””â”€â”€ AuthForm.tsx


â¸»

1ï¸âƒ£ cognitoConfig.tsï¼ˆé…ç½®æ–‡ä»¶ï¼‰

// src/cognitoConfig.ts
export const poolData = {
  UserPoolId: 'ap-northeast-1_xxxxxxxx',  // æ›¿æ¢ä¸ºä½ çš„ User Pool ID
  ClientId: 'xxxxxxxxxxxxxxxxxxxxxxxxxx', // æ›¿æ¢ä¸ºä½ çš„ App client IDï¼ˆä¸å¯ç”¨ client secretï¼‰
};


â¸»

2ï¸âƒ£ AuthForm.tsxï¼ˆæ³¨å†Œ + ç™»å½•ç»„ä»¶ï¼‰

// src/AuthForm.tsx
import React, { useState } from 'react';
import {
  CognitoUserPool,
  CognitoUser,
  AuthenticationDetails,
} from 'amazon-cognito-identity-js';
import { poolData } from './cognitoConfig';

const userPool = new CognitoUserPool(poolData);

const AuthForm: React.FC = () => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [email, setEmail] = useState('');
  const [mode, setMode] = useState<'login' | 'register'>('register');
  const [message, setMessage] = useState('');

  const handleRegister = () => {
    userPool.signUp(username, password, [{ Name: 'email', Value: email }], [], (err, result) => {
      if (err) {
        setMessage(`âŒ æ³¨å†Œå¤±è´¥: ${err.message || JSON.stringify(err)}`);
        return;
      }
      setMessage(`âœ… æ³¨å†ŒæˆåŠŸï¼Œè¯·éªŒè¯é‚®ä»¶åç™»å½•ï¼ˆç”¨æˆ·å: ${result?.user.getUsername()}ï¼‰`);
    });
  };

  const handleLogin = () => {
    const authDetails = new AuthenticationDetails({
      Username: username,
      Password: password,
    });

    const user = new CognitoUser({
      Username: username,
      Pool: userPool,
    });

    user.authenticateUser(authDetails, {
      onSuccess: (session) => {
        const idToken = session.getIdToken().getJwtToken();
        setMessage(`âœ… ç™»å½•æˆåŠŸï¼ID Token: ${idToken}`);
        // ä½ å¯ä»¥å°† idToken å­˜å…¥ localStorage æˆ–å‘é€åˆ°åç«¯
      },
      onFailure: (err) => {
        setMessage(`âŒ ç™»å½•å¤±è´¥: ${err.message || JSON.stringify(err)}`);
      },
    });
  };

  return (
    <div>
      <h2>{mode === 'register' ? 'æ³¨å†Œç”¨æˆ·' : 'ç™»å½•'}</h2>
      <input
        type="text"
        placeholder="ç”¨æˆ·å"
        value={username}
        onChange={(e) => setUsername(e.target.value)}
      /><br />
      {mode === 'register' && (
        <input
          type="email"
          placeholder="é‚®ç®±"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
        />
      )}<br />
      <input
        type="password"
        placeholder="å¯†ç "
        value={password}
        onChange={(e) => setPassword(e.target.value)}
      /><br />
      <button onClick={mode === 'register' ? handleRegister : handleLogin}>
        {mode === 'register' ? 'æ³¨å†Œ' : 'ç™»å½•'}
      </button>
      <br />
      <button onClick={() => setMode(mode === 'register' ? 'login' : 'register')}>
        åˆ‡æ¢åˆ°{mode === 'register' ? 'ç™»å½•' : 'æ³¨å†Œ'}
      </button>
      <p>{message}</p>
    </div>
  );
};

export default AuthForm;


â¸»

3ï¸âƒ£ App.tsxï¼ˆå…¥å£ï¼‰

// src/App.tsx
import React from 'react';
import AuthForm from './AuthForm';

const App: React.FC = () => {
  return (
    <div>
      <h1>AWS Cognito ç™»å½•ç¤ºä¾‹</h1>
      <AuthForm />
    </div>
  );
};

export default App;


â¸»

ğŸ§ª æµ‹è¯•æ–¹æ³•
	1.	å¯åŠ¨å‰ç«¯ npm start
	2.	è¿›è¡Œæ³¨å†Œï¼ˆCognito ä¼šå‘éªŒè¯é‚®ä»¶ï¼‰
	3.	é‚®ç®±ç¡®è®¤åï¼Œåˆ‡æ¢åˆ°ç™»å½•æ¨¡å¼ï¼Œæµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸ç™»å½•

â¸»

ğŸ“Œ æé†’
	â€¢	é‚®ç®±éªŒè¯åæ‰èƒ½ç™»å½•ï¼Œé™¤éä½ ä½¿ç”¨ Python è„šæœ¬é‡Œçš„ admin_confirm_sign_up()ã€‚
	â€¢	ç™»å½•æˆåŠŸåæ‹¿åˆ°çš„ ID Token å¯ä»¥ç”¨äºè°ƒç”¨ API Gatewayï¼ˆå¸¦ Cognito éªŒè¯ï¼‰ã€‚

â¸»

éœ€è¦æˆ‘å¸®ä½ æ¥å…¥ API Gateway å’Œ Lambda å—ï¼Ÿæˆ–è€…å¸Œæœ›å¢åŠ è‡ªåŠ¨ç¡®è®¤ç”¨æˆ·åŠŸèƒ½ï¼Ÿ



