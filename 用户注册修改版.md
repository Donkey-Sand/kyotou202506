å¥½çš„ï¼ä»¥ä¸‹æ˜¯ä½ æ‰€éœ€çš„ âœ… å®Œæ•´æ³¨å†Œè„šæœ¬ï¼ˆregister_user.pyï¼‰ï¼ŒåŒ…å«ï¼š
	â€¢	æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
	â€¢	è‹¥æœªç¡®è®¤åˆ™è‡ªåŠ¨é‡å‘éªŒè¯ç å¹¶å…è®¸é‡æ–°è¾“å…¥
	â€¢	å…è®¸å¤šæ¬¡è¾“å…¥ç¡®è®¤ç 
	â€¢	ç”¨æˆ·æ³¨å†ŒæˆåŠŸåç«‹å³è§¦å‘é‚®ç®±ç¡®è®¤æµç¨‹ï¼ˆæˆ–ä½¿ç”¨ç®¡ç†å‘˜ç¡®è®¤ä¹Ÿå¯ï¼‰

â¸»

âœ… å®Œæ•´è„šæœ¬ï¼ˆregister_user.pyï¼‰

import boto3
from botocore.exceptions import ClientError

# Cognito é…ç½®
USER_POOL_ID = 'ap-northeast-1_xxxxxxxx'
CLIENT_ID = 'xxxxxxxxxxxxxxxxxxxxxxxxxx'
REGION = 'ap-northeast-1'

# è¦æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯ä»¥æ”¹æˆä»è¾“å…¥è¯»å–ï¼‰
username = 'exampleuser'
password = 'ExamplePassword123!'  # å¿…é¡»ç¬¦åˆ Cognito å¯†ç ç­–ç•¥
email = 'user@example.com'

# åˆå§‹åŒ– Cognito å®¢æˆ·ç«¯
client = boto3.client('cognito-idp', region_name=REGION)


def check_user_exists_and_resend_code(username):
    try:
        user = client.admin_get_user(
            UserPoolId=USER_POOL_ID,
            Username=username
        )
        status = user['UserStatus']
        if status == 'UNCONFIRMED':
            print("âš ï¸ ç”¨æˆ·å·²å­˜åœ¨ä½†å°šæœªç¡®è®¤ï¼Œå°†é‡æ–°å‘é€éªŒè¯ç ã€‚")
            client.resend_confirmation_code(
                ClientId=CLIENT_ID,
                Username=username
            )
            return True
        elif status == 'CONFIRMED':
            print("âœ… ç”¨æˆ·å·²å­˜åœ¨ä¸”å·²ç¡®è®¤ï¼Œè¯·ç›´æ¥ç™»å½•ã€‚")
            return False
    except client.exceptions.UserNotFoundException:
        return None  # ç”¨æˆ·ä¸å­˜åœ¨
    except ClientError as e:
        print("âŒ æ£€æŸ¥ç”¨æˆ·çŠ¶æ€å¤±è´¥ï¼š", e.response['Error']['Message'])
        return None


def register_user():
    user_status = check_user_exists_and_resend_code(username)
    if user_status is True:
        confirm_user()
        return
    elif user_status is False:
        return

    try:
        response = client.sign_up(
            ClientId=CLIENT_ID,
            Username=username,
            Password=password,
            UserAttributes=[
                {
                    'Name': 'email',
                    'Value': email
                }
            ]
        )
        print("âœ… æ³¨å†ŒæˆåŠŸï¼å·²å‘é€ç¡®è®¤é‚®ä»¶ã€‚")
        confirm_user()
    except client.exceptions.UsernameExistsException:
        print("âš ï¸ ç”¨æˆ·åå·²å­˜åœ¨ã€‚")
        if check_user_exists_and_resend_code(username):
            confirm_user()
    except ClientError as e:
        print("âŒ æ³¨å†Œå¤±è´¥:", e.response['Error']['Message'])


def confirm_user():
    print("=== ğŸ“§ è¯·è¾“å…¥æ‚¨æ”¶åˆ°çš„é‚®ç®±ç¡®è®¤ç  ===")
    for attempt in range(3):
        code = input(f"ç¡®è®¤ç ï¼ˆç¬¬ {attempt + 1} æ¬¡å°è¯•ï¼‰ï¼š")
        try:
            response = client.confirm_sign_up(
                ClientId=CLIENT_ID,
                Username=username,
                ConfirmationCode=code
            )
            print("âœ… é‚®ç®±éªŒè¯æˆåŠŸï¼Œç”¨æˆ·å·²ç¡®è®¤ï¼")
            return
        except ClientError as e:
            print(f"âŒ éªŒè¯å¤±è´¥: {e.response['Error']['Message']}")
    print("ğŸš« å¤šæ¬¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜ã€‚")


# å¦‚æœä½ å¸Œæœ›ç”¨ç®¡ç†å‘˜ç¡®è®¤æ–¹å¼ï¼Œå¯ä»¥æ›¿ä»£ confirm_user()
def admin_confirm_user():
    try:
        response = client.admin_confirm_sign_up(
            UserPoolId=USER_POOL_ID,
            Username=username
        )
        print("âœ… ç®¡ç†å‘˜å·²ç¡®è®¤è¯¥ç”¨æˆ·")
    except ClientError as e:
        print("âŒ ç®¡ç†å‘˜ç¡®è®¤å¤±è´¥:", e.response['Error']['Message'])


if __name__ == '__main__':
    register_user()


â¸»

ğŸ“ ä½¿ç”¨è¯´æ˜ç®€è¿°
	â€¢	é»˜è®¤æµç¨‹æ˜¯ã€Œæ³¨å†Œ â†’ è‡ªåŠ¨å‘é€éªŒè¯ç  â†’ æœ€å¤šè¾“å…¥ 3 æ¬¡ç¡®è®¤ç ã€
	â€¢	å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ä½†æœªç¡®è®¤ï¼Œåˆ™ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è‡ªåŠ¨é‡å‘éªŒè¯ç ï¼Œå¹¶æç¤ºç¡®è®¤
	â€¢	å¦‚æœç”¨æˆ·å·²ç¡®è®¤ï¼Œä¼šæç¤ºâ€œè¯·ç›´æ¥ç™»å½•â€

â¸»

ğŸ§ª å¯é€‰å¢å¼ºåŠŸèƒ½
	â€¢	å°†ç”¨æˆ·ä¿¡æ¯æ”¹ä¸º input() åŠ¨æ€è¾“å…¥ï¼ˆé€‚åˆ CLI ä½¿ç”¨ï¼‰
	â€¢	å°†æ³¨å†Œè®°å½•å­˜å…¥æ—¥å¿—
	â€¢	è‡ªåŠ¨åˆ é™¤ UNCONFIRMED ç”¨æˆ·ï¼ˆæ…ç”¨ï¼‰

â¸»

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ åŒæ—¶æ›´æ–° README çš„æ³¨å†Œæµç¨‹è¯´æ˜ï¼Œæˆ–è€…æŠŠå®ƒæ‰“åŒ…æˆäº¤ä»˜ç‰© zip åŒ…ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ





å¥½çš„ï¼Œä¸‹é¢æ˜¯æ›´æ–°åçš„ README.md æ—¥æ–‡ç‰ˆï¼Œç»“åˆä½ ç°åœ¨çš„è„šæœ¬åŠŸèƒ½ï¼Œç‰¹åˆ«åŠ å…¥äº†ï¼š
	â€¢	è‡ªåŠ¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
	â€¢	å†å‘é€ç¢ºèªã‚³ãƒ¼ãƒ‰ï¼ˆresendï¼‰
	â€¢	å¤šå›å…¥åŠ›ç¢ºèªã‚³ãƒ¼ãƒ‰
	â€¢	ã€Œæœªç¢ºèªçŠ¶æ…‹ã®å†ç™»éŒ²ã€ã¸ã®å¯¾å¿œ

â¸»

ğŸ” AWS Cognito ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AWS Cognito ä¸Šã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™»éŒ²ã—ã€Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã‚’è¡Œã†ãŸã‚ã®ãƒ•ãƒ«ã‚»ãƒƒãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚
	â€¢	ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼šPython + boto3 ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å‡¦ç†ï¼ˆæœªç¢ºèªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å†ç¢ºèªã«å¯¾å¿œï¼‰
	â€¢	ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼šReact + amazon-cognito-identity-js ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
	â€¢	ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ã€ä¸€æ™‚çš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®ä½¿ç”¨æ–¹æ³•ã‚‚è¨˜è¼‰

â¸»

ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

.
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ register_user.py         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆç¢ºèªã‚³ãƒ¼ãƒ‰å†é€ï¼†å†å…¥åŠ›å¯¾å¿œï¼‰
â”‚   â””â”€â”€ pyproject.toml           # uv ç”¨ä¾å­˜è¨­å®š
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.tsx              # React ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚       â”œâ”€â”€ AuthForm.tsx         # ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ 
â”‚       â””â”€â”€ cognitoConfig.ts     # Cognito è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ README.md                    # ä½¿ç”¨èª¬æ˜æ›¸


â¸»

âš™ï¸ å‰ææ¡ä»¶
	â€¢	AWS Cognito ã® User Pool ãŠã‚ˆã³ App Clientï¼ˆclient secret ç„¡åŠ¹ï¼‰ãŒä½œæˆæ¸ˆã¿
	â€¢	ä»¥ä¸‹ã®ç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼š
	â€¢	Python 3.8+
	â€¢	Node.js
	â€¢	AWS CLI
	â€¢	uvï¼šPython ä»®æƒ³ç’°å¢ƒãƒ»ä¾å­˜ç®¡ç†ãƒ„ãƒ¼ãƒ«

â¸»

ğŸš€ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨æ–¹æ³•ï¼ˆregister_user.pyï¼‰

1. è¨­å®šã®ç·¨é›†

register_user.py å†…ã®ä»¥ä¸‹ã‚’è¨­å®šã—ã¾ã™ï¼š

USER_POOL_ID = 'ap-northeast-1_XXXXXXX'
CLIENT_ID = 'xxxxxxxxxxxxxxxxxxxxxxxxxx'
REGION = 'ap-northeast-1'

username = 'exampleuser'
password = 'ExamplePassword123!'
email = 'user@example.com'

2. uv ã‚’ä½¿ã£ãŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

cd backend
uv venv
uv pip install .

3. å®Ÿè¡Œæ–¹æ³•

uv venv exec python register_user.py


â¸»

ğŸ§  æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ©Ÿèƒ½æ¦‚è¦
	â€¢	åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒå­˜åœ¨ã™ã‚‹å ´åˆã€UNCONFIRMED çŠ¶æ…‹ã§ã‚ã‚Œã°ç¢ºèªã‚³ãƒ¼ãƒ‰ã‚’å†é€
	â€¢	ç¢ºèªã‚³ãƒ¼ãƒ‰ã¯æœ€å¤§3å›ã¾ã§å…¥åŠ›å¯èƒ½ï¼ˆå¤±æ•—æ™‚ã‚‚å³çµ‚äº†ã›ãšï¼‰
	â€¢	ã™ã§ã« CONFIRMED ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ç™»éŒ²ä¸å¯ï¼ˆã€Œãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€ã¨æ¡ˆå†…ï¼‰

â¸»

ğŸŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰å®Ÿè¡Œæ‰‹é †

1. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

cd frontend
npm install

2. Cognito è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£ï¼ˆsrc/cognitoConfig.tsï¼‰

export const poolData = {
  UserPoolId: 'ap-northeast-1_XXXXXXX',
  ClientId: 'xxxxxxxxxxxxxxxxxxxxxxxxxx',
};

3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®èµ·å‹•

npm start


â¸»

ğŸ” ä¸€æ™‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®ä½¿ç”¨æ–¹æ³•ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼‰

1. STS ã‚’ä½¿ã£ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—

aws sts get-session-token --duration-seconds 3600

å‡ºåŠ›ã•ã‚ŒãŸ AccessKey/SecretKey/SessionToken ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šï¼š

export AWS_ACCESS_KEY_ID="..."
export AWS_SECRET_ACCESS_KEY="..."
export AWS_SESSION_TOKEN="..."

ãã®å¾Œã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œï¼š

uv venv exec python register_user.py


â¸»

âœ… æ³¨æ„äº‹é …
	â€¢	ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ Cognito ã®ãƒãƒªã‚·ãƒ¼ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆä¾‹ï¼šå¤§æ–‡å­—ãƒ»æ•°å­—ãƒ»è¨˜å·å«ã‚€8æ–‡å­—ä»¥ä¸Šï¼‰
	â€¢	ç¢ºèªã‚³ãƒ¼ãƒ‰å…¥åŠ›ã«è¤‡æ•°å›å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€æœŸé™åˆ‡ã‚Œã‚„å¤±æ•—æ™‚ã¯å†ç™»éŒ²ãŒå¿…è¦ã§ã™
	â€¢	ç™»éŒ²å¾Œã€ãƒ­ã‚°ã‚¤ãƒ³ã«ã¯ç¢ºèªæ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹ã“ã¨ãŒå¿…é ˆã§ã™

â¸»

ğŸ“ ã‚µãƒãƒ¼ãƒˆãƒ»ãŠå•ã„åˆã‚ã›

ã”ä¸æ˜ç‚¹ã‚„ãƒˆãƒ©ãƒ–ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‹…å½“è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚

â¸»

å¦‚æœä½ éœ€è¦æˆ‘å†æŠŠè¿™ä¸ª README è½¬ä¸º Markdown æ–‡ä»¶æˆ–æ‰“åŒ…é¡¹ç›®ç›®å½• ZIP åŒ…ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ




